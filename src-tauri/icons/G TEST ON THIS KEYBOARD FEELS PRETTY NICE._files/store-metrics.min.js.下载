!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t=e(function(e,t){!function(t){if(e.exports=t(),!!0){var r=window.Cookies,n=window.Cookies=t();n.noConflict=function(){return window.Cookies=r,n}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(r){function n(t,o,s){var i;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(s=e({path:"/"},n.defaults,s)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*s.expires),s.expires=a}s.expires=s.expires?s.expires.toUTCString():"";try{i=JSON.stringify(o),/^[\{\[]/.test(i)&&(o=i)}catch(e){}o=r.write?r.write(o,t):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var c="";for(var u in s)s[u]&&(c+="; "+u,!0!==s[u]&&(c+="="+s[u]));return document.cookie=t+"="+o+c}t||(i={});for(var l=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,f=0;f<l.length;f++){var p=l[f].split("="),h=p.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{var m=p[0].replace(d,decodeURIComponent);if(h=r.read?r.read(h,m):r(h,m)||h.replace(d,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(e){}if(t===m){i=h;break}t||(i[m]=h)}catch(e){}}return i}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,r){n(t,"",e(r,{expires:-1}))},n.withConverter=t,n}return t(function(){})})}),r=e(function(e,t){!function(r){function n(e,t){t=t||{},this._id=n._generateUUID(),this._promise=t.promise||Promise,this._frameId=t.frameId||"CrossStorageClient-"+this._id,this._origin=n._getOrigin(e),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=t.timeout||5e3,this._listener=null,this._installListener();var r;t.frameId&&(r=document.getElementById(t.frameId)),r&&this._poll(),r=r||this._createFrame(e),this._hub=r.contentWindow}n.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},n._getOrigin=function(e){var t,r,n;return t=document.createElement("a"),t.href=e,t.host||(t=window.location),r=t.protocol&&":"!==t.protocol?t.protocol:window.location.protocol,n=r+"//"+t.host,n=n.replace(/:80$|:443$/,"")},n._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},n.prototype.onConnect=function(){var e=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise(function(t,r){var n=setTimeout(function(){r(new Error("CrossStorageClient could not connect"))},e._timeout);e._requests.connect.push(function(e){if(clearTimeout(n),e)return r(e);t()})}))},n.prototype.set=function(e,t,r){return this._request("set",{key:e,value:t,ttl:r})},n.prototype.get=function(e){var t=Array.prototype.slice.call(arguments);return this._request("get",{keys:t})},n.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},n.prototype.clear=function(){return this._request("clear")},n.prototype.getKeys=function(){return this._request("getKeys")},n.prototype.close=function(){var e=document.getElementById(this._frameId);e&&e.parentNode.removeChild(e),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},n.prototype._installListener=function(){var e=this;this._listener=function(t){var r,n,o;if(!e._closed&&t.data&&"string"==typeof t.data&&("null"===t.origin?"file://":t.origin)===e._origin)if("cross-storage:unavailable"!==t.data){if(-1!==t.data.indexOf("cross-storage:")&&!e._connected){if(e._connected=!0,!e._requests.connect)return;for(r=0;r<e._requests.connect.length;r++)e._requests.connect[r](n);delete e._requests.connect}if("cross-storage:ready"!==t.data){try{o=JSON.parse(t.data)}catch(e){return}o.id&&e._requests[o.id]&&e._requests[o.id](o.error,o.result)}}else{if(e._closed||e.close(),!e._requests.connect)return;for(n=new Error("Closing client. Could not access localStorage in hub."),r=0;r<e._requests.connect.length;r++)e._requests.connect[r](n)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},n.prototype._poll=function(){var e,t,r;r="file://"===(e=this)._origin?"*":e._origin,t=setInterval(function(){if(e._connected)return clearInterval(t);e._hub&&e._hub.postMessage("cross-storage:poll",r)},1e3)},n.prototype._createFrame=function(e){var t,r;(t=window.document.createElement("iframe")).id=this._frameId;for(r in n.frameStyle)n.frameStyle.hasOwnProperty(r)&&(t.style[r]=n.frameStyle[r]);return window.document.body.appendChild(t),t.src=e,t},n.prototype._request=function(e,t){var r,n;return this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(n=this,n._count++,r={id:this._id+":"+n._count,method:"cross-storage:"+e,params:t},new this._promise(function(e,t){var o,s,i;o=setTimeout(function(){n._requests[r.id]&&(delete n._requests[r.id],t(new Error("Timeout: could not perform "+r.method)))},n._timeout),n._requests[r.id]=function(s,i){if(clearTimeout(o),delete n._requests[r.id],s)return t(new Error(s));e(i)},Array.prototype.toJSON&&(s=Array.prototype.toJSON,Array.prototype.toJSON=null),i="file://"===n._origin?"*":n._origin,n._hub.postMessage(JSON.stringify(r),i),s&&(Array.prototype.toJSON=s)}))},e.exports?e.exports=n:t.CrossStorageClient=n}()}),n=(r.CrossStorageClient,["utm_source","utm_medium","utm_campaign","utm_term","utm_content"]),o={utm:12096e5,referrer:12096e5,landing_page:12096e5,discount:12096e5,partner_id:10368e6,promocode:10368e6,sscid:10368e6},s=function(e){var t=e.split(".");return"."+(t.length>2?t.slice(1).join("."):t.join("."))};!function(){var e={},i=new window.URL(document.location.href),a=function(e){var t=i.hostname.split(".");if(t.length>1)return t[t.length-2]}(),c="https://accounts."+(i.hostname.includes("labs")?"labs.":"")+"livechat.com/static/hub.html",u=Boolean(t.get("metrics_session")),l=n.filter(function(e){return i.searchParams.has(e)});l.length&&(e.utm={},l.forEach(function(t){e.utm[t]=i.searchParams.get(t)}));var d=document.referrer?new window.URL(document.referrer):null;d&&s(d.hostname)!==s(i.hostname)&&(e.referrer=d.href),u||(e.landing_page=i.origin+i.pathname),i.searchParams.has("discount")&&(e.discount=i.searchParams.get("discount")),i.searchParams.has("a")&&(e.partner_id=i.searchParams.get("a")),i.searchParams.has("partner_id")&&(e.partner_id=i.searchParams.get("partner_id")),i.searchParams.has("partner")&&(e.promocode=i.searchParams.get("partner")),i.searchParams.has("sscid")&&(e.sscid=i.searchParams.get("sscid"));var f=Object.keys(e);if(f.length){var p=new r(c),h=p.onConnect();f.forEach(function(t){h.then(function(){return p.set(a+":"+t,e[t],o[t])})}),h.catch(function(e){return console.error(e)}),t.set("metrics_session","true",{domain:s(i.hostname),samesite:"none",secure:!0,expires:14})}}()});
